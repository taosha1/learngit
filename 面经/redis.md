# redis设计与实现
-  字符串
1. redis使用简单动态字符串作为默认字符串表示
2. sds的结构体定义包含len，free和buf字节数组
3. 特点：以常数复杂度获取字符串长度，杜绝缓冲区溢出（在修改字符串前检查是否有足够的空间，不够则自动扩展| <1m 翻倍|>1m +1m），减少内存重分配次数（修改字符串长度n次最多需要执行n次内存重分配,通过未使用空间实现空间预分配和惰性空间释放），二进制安全（除了文本数据外还可以存储二进制数据，因为不以'\0'区分结尾，保证数据在写入和读取是一致的），兼容部分c字符串标准库（达到复用的目的）
- 链表
1. 双端，无环，带表头指针和表尾指针。带链表长度，多态（使用void*保存节点值，存任何类型）
- 字典
1. 字典定义中有了个hash表，在表1rehash时，使用第二个
2. redis先根据type字段的哈希函数计算哈希值随后和sizemask进行位运算，得到索引值
3. redis使用链地址法解决hash冲突
4. rehash，为了维持负载因子（used/size）保持在合理范围，程序会对hash表的大小进行相应的扩展和收缩。步骤如下:1为第二个hash表分配空间，分配的大小取决于第一个表的used字段（2的n次方幂） 2将第一个表的所有键值对放到新表去 3释放表1的空间，将表2交换为表1，新的表2创建为一个空白hash表为下一次rehash做准备
5. 采用渐进式hash，维持一个索引计数器变量rehashidx（-1表示未在rehash状态）。程序除了执行指定操作外还会顺带将索引所指向的所有键值对rehash到表2.当rehash完成时，将计算器设置为-1。这种方式采取了分而治之的思想，将庞大的计算工作分摊到对字典的每个crud操作上，避免了集中式rehash的性能影响。
6. 在这个过错中，查找删除更新等操作会在两个表上进行，但是添加操作会直接在表2进行，保证表1的键值对数量只减不增。
- 跳跃表
1. 跳跃表是一种有序数据结构，他通过在每个节点中维持多个指向其他节点的指针达到快速访问节点的目的。平均O(logN)最坏O(N)复杂度。
2. redis使用跳跃表作为有序集合键的底层实现